/**
 **************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 **************************************************************************
 * @attention
 *
 * Copyright (c) 2025 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 **************************************************************************
 */

#include <stdint.h>
#include <stdio.h>
#include "stm32_f446xx.h"
#define LED_PIN         5
#define BUTTON_PIN      13

 void delay_5ms(void)
 {
     for (volatile uint32_t i = 0; i < 840000; i++);
 }

int main(void)
{

 GPIOA_CLK_EN() ; // clock gpioA enable
 GPIOC_CLK_EN() ; // ENABLING GPIOC PORT

 GPIOA->MODER &= ~(0x3 << (LED_PIN*2));  // make 10 11 posisiton zero
 GPIOA->MODER |= (0X1<<(LED_PIN*2));  //- 01 → General-purpose outputmode to pin 11 and 10

 GPIOC->MODER &= ~(0x3 << (BUTTON_PIN*2)); //MAKE 00 MODE, input mode
 GPIOA->OTYPER &= ~(0X1<<LED_PIN);   //- Clearing bit 5 makes pin 5 push-pull (standard LED drive).

 GPIOA ->OSPEEDR  &= ~(0x3 << (LED_PIN*2));
 GPIOA->OSPEEDR |= (0X1<<(LED_PIN*2));  // - 01 → Medium speed


 GPIOA ->PUPDR &= ~(0x3 << (LED_PIN*2)); // - 00 → No pull-up/pull-down
 GPIOC ->PUPDR &= ~(0x3 << (LED_PIN*2));
 GPIOC ->PUPDR |= (0X1<< (LED_PIN*2));

  while (1)
     {

   if(!(GPIOC->IDR & (1 << BUTTON_PIN)))
           {
               // Button is pressed (reads 0)
               // Turn ON LED using BSRR (Bit Set/Reset Register)
               GPIOA->BSRR = (1 << LED_PIN);         // Set bit (turn LED ON)
               printf("button is pressed\n");
               // Simple debounce delay
               delay_5ms();
           }

   else
           {
               // Button is not pressed (reads 1)
               // Turn OFF LED using BSRR
               GPIOA->BSRR = (1 << (LED_PIN + 16));  // Reset bit (turn LED OFF)
              // printf("button is released");
           }

     }
}
