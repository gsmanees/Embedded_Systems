/*
 * oled.c
 *
 * Created: 28-12-2025 8.34.03 AM
 *  Author: anees
 */ 

#define F_CPU 16000000UL
#include "oled.h"
#include "i2c.h"
#include <util/delay.h>

	uint8_t oled_x = 0;
	uint8_t oled_page = 0;
		uint8_t i, bit;
		uint8_t index;
		uint8_t col;
		uint8_t up_scaled, low_scaled;
		uint8_t x, page;

#define OLED_ADDR 0x78   // 0x3C << 1

// ASCII 32–127, 6x8 column-major font
const uint8_t Font6x8[][6] = {
	{0x00,0x00,0x00,0x00,0x00,0x00}, // ' ' 32
	{0x00,0x00,0x5F,0x00,0x00,0x00}, // ! 33
	{0x00,0x07,0x00,0x07,0x00,0x00}, // " 34
	{0x14,0x7F,0x14,0x7F,0x14,0x00}, // # 35
	{0x24,0x2A,0x7F,0x2A,0x12,0x00}, // $ 36
	{0x23,0x13,0x08,0x64,0x62,0x00}, // % 37
	{0x36,0x49,0x55,0x22,0x50,0x00}, // & 38
	{0x00,0x05,0x03,0x00,0x00,0x00}, // ' 39
	{0x00,0x1C,0x22,0x41,0x00,0x00}, // ( 40
	{0x00,0x41,0x22,0x1C,0x00,0x00}, // ) 41
	{0x14,0x08,0x3E,0x08,0x14,0x00}, // * 42
	{0x08,0x08,0x3E,0x08,0x08,0x00}, // + 43
	{0x00,0x50,0x30,0x00,0x00,0x00}, // , 44
	{0x08,0x08,0x08,0x08,0x08,0x00}, // - 45
	{0x00,0x60,0x60,0x00,0x00,0x00}, // . 46
	{0x20,0x10,0x08,0x04,0x02,0x00}, // / 47
	{0x3E,0x51,0x49,0x45,0x3E,0x00}, // 0 48
	{0x00,0x42,0x7F,0x40,0x00,0x00}, // 1 49
	{0x42,0x61,0x51,0x49,0x46,0x00}, // 2 50
	{0x21,0x41,0x45,0x4B,0x31,0x00}, // 3 51
	{0x18,0x14,0x12,0x7F,0x10,0x00}, // 4 52
	{0x27,0x45,0x45,0x45,0x39,0x00}, // 5 53
	{0x3C,0x4A,0x49,0x49,0x30,0x00}, // 6 54
	{0x01,0x71,0x09,0x05,0x03,0x00}, // 7 55
	{0x36,0x49,0x49,0x49,0x36,0x00}, // 8 56
	{0x06,0x49,0x49,0x29,0x1E,0x00}, // 9 57
	{0x00,0x36,0x36,0x00,0x00,0x00}, // : 58
	{0x00,0x56,0x36,0x00,0x00,0x00}, // ; 59
	{0x08,0x14,0x22,0x41,0x00,0x00}, // < 60
	{0x14,0x14,0x14,0x14,0x14,0x00}, // = 61
	{0x00,0x41,0x22,0x14,0x08,0x00}, // > 62
	{0x02,0x01,0x51,0x09,0x06,0x00}, // ? 63
	{0x32,0x49,0x79,0x41,0x3E,0x00}, // @ 64
	{0x7E,0x11,0x11,0x11,0x7E,0x00}, // A 65
	{0x7F,0x49,0x49,0x49,0x36,0x00}, // B 66
	{0x3E,0x41,0x41,0x41,0x22,0x00}, // C 67
	{0x7F,0x41,0x41,0x22,0x1C,0x00}, // D 68
	{0x7F,0x49,0x49,0x49,0x41,0x00}, // E 69
	{0x7F,0x09,0x09,0x09,0x01,0x00}, // F 70
	{0x3E,0x41,0x49,0x49,0x7A,0x00}, // G 71
	{0x7F,0x08,0x08,0x08,0x7F,0x00}, // H 72
	{0x00,0x41,0x7F,0x41,0x00,0x00}, // I 73
	{0x20,0x40,0x41,0x3F,0x01,0x00}, // J 74
	{0x7F,0x08,0x14,0x22,0x41,0x00}, // K 75
	{0x7F,0x40,0x40,0x40,0x40,0x00}, // L 76
	{0x7F,0x02,0x0C,0x02,0x7F,0x00}, // M 77
	{0x7F,0x04,0x08,0x10,0x7F,0x00}, // N 78
	{0x3E,0x41,0x41,0x41,0x3E,0x00}, // O 79
	{0x7F,0x09,0x09,0x09,0x06,0x00}, // P 80
	{0x3E,0x41,0x51,0x21,0x5E,0x00}, // Q 81
	{0x7F,0x09,0x19,0x29,0x46,0x00}, // R 82
	{0x46,0x49,0x49,0x49,0x31,0x00}, // S 83
	{0x01,0x01,0x7F,0x01,0x01,0x00}, // T 84
	{0x3F,0x40,0x40,0x40,0x3F,0x00}, // U 85
	{0x1F,0x20,0x40,0x20,0x1F,0x00}, // V 86
	{0x3F,0x40,0x38,0x40,0x3F,0x00}, // W 87
	{0x63,0x14,0x08,0x14,0x63,0x00}, // X 88
	{0x07,0x08,0x70,0x08,0x07,0x00}, // Y 89
	{0x61,0x51,0x49,0x45,0x43,0x00}, // Z 90
	{0x00,0x7F,0x41,0x41,0x00,0x00}, // [ 91
	{0x02,0x04,0x08,0x10,0x20,0x00}, // \ 92
	{0x00,0x41,0x41,0x7F,0x00,0x00}, // ] 93
	{0x04,0x02,0x01,0x02,0x04,0x00}, // ^ 94
	{0x40,0x40,0x40,0x40,0x40,0x00}, // _ 95
	{0x00,0x01,0x02,0x04,0x00,0x00}, // ` 96
	{0x20,0x54,0x54,0x54,0x78,0x00}, // a 97
	{0x7F,0x48,0x44,0x44,0x38,0x00}, // b 98
	{0x38,0x44,0x44,0x44,0x20,0x00}, // c 99
	{0x38,0x44,0x44,0x48,0x7F,0x00}, // d 100
	{0x38,0x54,0x54,0x54,0x18,0x00}, // e 101
	{0x08,0x7E,0x09,0x01,0x02,0x00}, // f 102
	{0x0C,0x52,0x52,0x52,0x3E,0x00}, // g 103
	{0x7F,0x08,0x04,0x04,0x78,0x00}, // h 104
	{0x00,0x44,0x7D,0x40,0x00,0x00}, // i 105
	{0x20,0x40,0x44,0x3D,0x00,0x00}  // j 106 (partial, can extend for all ASCII)
};


const uint8_t Font5x7[][5] = {
	// ASCII 32–127
	{0x00,0x00,0x00,0x00,0x00}, // ' ' 32
	{0x00,0x00,0x5F,0x00,0x00}, // ! 33
	{0x00,0x07,0x00,0x07,0x00}, // " 34
	{0x14,0x7F,0x14,0x7F,0x14}, // # 35
	{0x24,0x2A,0x7F,0x2A,0x12}, // $ 36
	{0x23,0x13,0x08,0x64,0x62}, // % 37
	{0x36,0x49,0x55,0x22,0x50}, // & 38
	{0x00,0x05,0x03,0x00,0x00}, // ' 39
	{0x00,0x1C,0x22,0x41,0x00}, // ( 40
	{0x00,0x41,0x22,0x1C,0x00}, // ) 41
	{0x14,0x08,0x3E,0x08,0x14}, // * 42
	{0x08,0x08,0x3E,0x08,0x08}, // + 43
	{0x00,0x50,0x30,0x00,0x00}, // , 44
	{0x08,0x08,0x08,0x08,0x08}, // - 45
	{0x00,0x60,0x60,0x00,0x00}, // . 46
	{0x20,0x10,0x08,0x04,0x02}, // / 47
	{0x3E,0x51,0x49,0x45,0x3E}, // 0 48
	{0x00,0x42,0x7F,0x40,0x00}, // 1 49
	{0x42,0x61,0x51,0x49,0x46}, // 2 50
	{0x21,0x41,0x45,0x4B,0x31}, // 3 51
	{0x18,0x14,0x12,0x7F,0x10}, // 4 52
	{0x27,0x45,0x45,0x45,0x39}, // 5 53
	{0x3C,0x4A,0x49,0x49,0x30}, // 6 54
	{0x01,0x71,0x09,0x05,0x03}, // 7 55
	{0x36,0x49,0x49,0x49,0x36}, // 8 56
	{0x06,0x49,0x49,0x29,0x1E}, // 9 57
	{0x00,0x36,0x36,0x00,0x00}, // : 58
	{0x00,0x56,0x36,0x00,0x00}, // ; 59
	{0x08,0x14,0x22,0x41,0x00}, // < 60
	{0x14,0x14,0x14,0x14,0x14}, // = 61
	{0x00,0x41,0x22,0x14,0x08}, // > 62
	{0x02,0x01,0x51,0x09,0x06}, // ? 63
	{0x32,0x49,0x79,0x41,0x3E}, // @ 64
	{0x7E,0x11,0x11,0x11,0x7E}, // A 65
	{0x7F,0x49,0x49,0x49,0x36}, // B 66
	{0x3E,0x41,0x41,0x41,0x22}, // C 67
	{0x7F,0x41,0x41,0x22,0x1C}, // D 68
	{0x7F,0x49,0x49,0x49,0x41}, // E 69
	{0x7F,0x09,0x09,0x09,0x01}, // F 70
	{0x3E,0x41,0x49,0x49,0x7A}, // G 71
	{0x7F,0x08,0x08,0x08,0x7F}, // H 72
	{0x00,0x41,0x7F,0x41,0x00}, // I 73
	{0x20,0x40,0x41,0x3F,0x01}, // J 74
	{0x7F,0x08,0x14,0x22,0x41}, // K 75
	{0x7F,0x40,0x40,0x40,0x40}, // L 76
	{0x7F,0x02,0x0C,0x02,0x7F}, // M 77
	{0x7F,0x04,0x08,0x10,0x7F}, // N 78
	{0x3E,0x41,0x41,0x41,0x3E}, // O 79
	{0x7F,0x09,0x09,0x09,0x06}, // P 80
	{0x3E,0x41,0x51,0x21,0x5E}, // Q 81
	{0x7F,0x09,0x19,0x29,0x46}, // R 82
	{0x46,0x49,0x49,0x49,0x31}, // S 83
	{0x01,0x01,0x7F,0x01,0x01}, // T 84
	{0x3F,0x40,0x40,0x40,0x3F}, // U 85
	{0x1F,0x20,0x40,0x20,0x1F}, // V 86
	{0x3F,0x40,0x38,0x40,0x3F}, // W 87
	{0x63,0x14,0x08,0x14,0x63}, // X 88
	{0x07,0x08,0x70,0x08,0x07}, // Y 89
	{0x61,0x51,0x49,0x45,0x43}, // Z 90
	{0x00,0x7F,0x41,0x41,0x00}, // [ 91
	{0x02,0x04,0x08,0x10,0x20}, // \ 92
	{0x00,0x41,0x41,0x7F,0x00}, // ] 93
	{0x04,0x02,0x01,0x02,0x04}, // ^ 94
	{0x40,0x40,0x40,0x40,0x40}, // _ 95
	{0x00,0x01,0x02,0x04,0x00}, // ` 96
	{0x20,0x54,0x54,0x54,0x78}, // a 97
	{0x7F,0x48,0x44,0x44,0x38}, // b 98
	{0x38,0x44,0x44,0x44,0x20}, // c 99
	{0x38,0x44,0x44,0x48,0x7F}, // d 100
	{0x38,0x54,0x54,0x54,0x18}, // e 101
	{0x08,0x7E,0x09,0x01,0x02}, // f 102
	{0x0C,0x52,0x52,0x52,0x3E}, // g 103
	{0x7F,0x08,0x04,0x04,0x78}, // h 104
	{0x00,0x44,0x7D,0x40,0x00}, // i 105
	{0x20,0x40,0x44,0x3D,0x00}, // j 106
	{0x7F,0x10,0x28,0x44,0x00}, // k 107
	{0x00,0x41,0x7F,0x40,0x00}, // l 108
	{0x7C,0x04,0x18,0x04,0x78}, // m 109
	{0x7C,0x08,0x04,0x04,0x78}, // n 110
	{0x38,0x44,0x44,0x44,0x38}, // o 111
	{0x7C,0x14,0x14,0x14,0x08}, // p 112
	{0x08,0x14,0x14,0x18,0x7C}, // q 113
	{0x7C,0x08,0x04,0x04,0x08}, // r 114
	{0x48,0x54,0x54,0x54,0x20}, // s 115
	{0x04,0x3F,0x44,0x40,0x20}, // t 116
	{0x3C,0x40,0x40,0x20,0x7C}, // u 117
	{0x1C,0x20,0x40,0x20,0x1C}, // v 118
	{0x3C,0x40,0x30,0x40,0x3C}, // w 119
	{0x44,0x28,0x10,0x28,0x44}, // x 120
	{0x0C,0x50,0x50,0x50,0x3C}, // y 121
	{0x44,0x64,0x54,0x4C,0x44}, // z 122
	{0x00,0x08,0x36,0x41,0x00}, // { 123
	{0x00,0x00,0x7F,0x00,0x00}, // | 124
	{0x00,0x41,0x36,0x08,0x00}, // } 125
	{0x08,0x08,0x2A,0x1C,0x08}, // ~ 126
	{0x08,0x1C,0x2A,0x08,0x08}  // DEL 127
};


static const uint8_t font5x7[][5] = {
	{0x00,0x00,0x00,0x00,0x00}, // space
	{0x00,0x00,0x5F,0x00,0x00}, // !
	// add more characters later
};

void OLED_Command(uint8_t cmd)
{
	TWI_Start();
	TWI_Write(OLED_ADDR); // 0x3C << 1
	TWI_Write(0x00);   // Command mode
	TWI_Write(cmd);
	TWI_Stop();
}

void OLED_Data(uint8_t data)
{
	TWI_Start();
	TWI_Write(OLED_ADDR); // 0x78    0x3C << 1
	TWI_Write(0x40);   // Data mode
	TWI_Write(data);
	TWI_Stop();
}

void OLED_Init(void)
{
	_delay_ms(100);

	OLED_Command(0xAE); // Display OFF
	OLED_Command(0x20); // Memory mode
	OLED_Command(0x00);
	OLED_Command(0xB0); // Page 0
	OLED_Command(0xC8);
	OLED_Command(0x00);
	OLED_Command(0x10);
	OLED_Command(0x40);
	OLED_Command(0x81);
	OLED_Command(0x7F);
	OLED_Command(0xA1);
	OLED_Command(0xA6);
	OLED_Command(0xA8);
	OLED_Command(0x3F);
	OLED_Command(0xA4);
	OLED_Command(0xD3);
	OLED_Command(0x00);
	OLED_Command(0xD5);
	OLED_Command(0x80);
	OLED_Command(0xD9);
	OLED_Command(0xF1);
	OLED_Command(0xDA);
	OLED_Command(0x12);
	OLED_Command(0xDB);
	OLED_Command(0x40);
	OLED_Command(0x8D);
	OLED_Command(0x14);
	OLED_Command(0xAF); // Display ON

	OLED_Clear();
}

void OLED_Clear(void)
{
	for (uint8_t page = 0; page < 8; page++)
	{
		OLED_SetCursor(page, 0);
		for (uint8_t col = 0; col < 128; col++)
		OLED_Data(0x00);
	}
}

void OLED_SetCursor(uint8_t page, uint8_t col)
{
	 oled_x = x;
	 oled_page = page;
	OLED_Command(0xB0 + page);
	OLED_Command(0x00 + (col & 0x0F));
	OLED_Command(0x10 + (col >> 4));
}

void OLED_Char(char c)
{
	if (c < 32 || c > 126) return; // ignore out of range
	c -= 32;                       // font starts at space

	for (uint8_t i = 0; i < 5; i++)
	OLED_Data(Font5x7[(uint8_t)c][i]);

	OLED_Data(0x00); // spacing column
}


void OLED_String(char *str)
{
	while (*str)
	OLED_Char(*str++);
}



/* 8x8 font for digits 0–9 and ':' */
const uint8_t Font8x8[][8] =
{
	// '0'
	{0x3E,0x51,0x49,0x45,0x3E,0x00,0x00,0x00},
	// '1'
	{0x00,0x42,0x7F,0x40,0x00,0x00,0x00,0x00},
	// '2'
	{0x42,0x61,0x51,0x49,0x46,0x00,0x00,0x00},
	// '3'
	{0x21,0x41,0x45,0x4B,0x31,0x00,0x00,0x00},
	// '4'
	{0x18,0x14,0x12,0x7F,0x10,0x00,0x00,0x00},
	// '5'
	{0x27,0x45,0x45,0x45,0x39,0x00,0x00,0x00},
	// '6'
	{0x3C,0x4A,0x49,0x49,0x30,0x00,0x00,0x00},
	// '7'
	{0x01,0x71,0x09,0x05,0x03,0x00,0x00,0x00},
	// '8'
	{0x36,0x49,0x49,0x49,0x36,0x00,0x00,0x00},
	// '9'
	{0x06,0x49,0x49,0x29,0x1E,0x00,0x00,0x00},
	// ':'
	{0x00,0x36,0x36,0x00,0x00,0x00,0x00,0x00},
	// '-'
	{0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00}

};

const uint8_t Font16x32[10][64] =
{
	// Digit 0
	{
		0xF8,0xFC,0x0E,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x0E,0xFC,0xF8,0x00,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x60,0x60,0x60,0x60,0x60,0x60,0x70,0x3F,0x1F,0x00,0x00,0x00,
		0xF8,0xFC,0x0E,0x06,0x06,0x06,0x06,0x06,0x06,0x06,0x0E,0xFC,0xF8,0x00,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x60,0x60,0x60,0x60,0x60,0x60,0x70,0x3F,0x1F,0x00,0x00,0x00
	},

	// Digit 1
	{
		0x00,0x00,0x00,0x18,0x1C,0x1E,0x1E,0x18,0x18,0x18,0x18,0xFF,0xFF,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x60,0x60,0x7F,0x7F,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x18,0x1C,0x1E,0x1E,0x18,0x18,0x18,0x18,0xFF,0xFF,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x60,0x60,0x7F,0x7F,0x00,0x00,0x00,0x00
	},

	// Digit 2
	{
		0xF8,0xFC,0x0E,0x06,0x06,0x06,0x06,0x06,0x06,0x0E,0x1C,0x38,0xF0,0xE0,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x60,0x60,0x60,0x60,0x70,0x7F,0x3F,0x1F,0x00,0x00,0x00,0x00,
		0xF8,0xFC,0x0E,0x06,0x06,0x06,0x06,0x0E,0x1C,0x38,0xF0,0xE0,0x00,0x00,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x60,0x60,0x70,0x7F,0x3F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00
	},

	// Digit 3
	{
		0xF8,0xFC,0x0E,0x06,0x06,0x06,0x0E,0x3C,0x3C,0x0E,0x06,0x06,0x0E,0xFC,0xF8,0x00,
		0x1F,0x3F,0x70,0x60,0x60,0x70,0x3F,0x1F,0x3F,0x70,0x60,0x60,0x70,0x3F,0x1F,0x00,
		0xF8,0xFC,0x0E,0x06,0x06,0x0E,0x3C,0x3C,0x0E,0x06,0x06,0x0E,0xFC,0xF8,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x60,0x70,0x3F,0x1F,0x3F,0x70,0x60,0x60,0x70,0x3F,0x1F,0x00
	},

	// Digit 4
	{
		0x00,0x00,0x00,0x0C,0x1C,0x3C,0x6C,0xCC,0xFF,0xFF,0x0C,0x0C,0x0C,0x00,0x00,0x00,
		0x00,0x00,0x00,0x60,0x60,0x60,0x60,0x60,0x7F,0x7F,0x60,0x60,0x60,0x00,0x00,0x00,
		0x00,0x00,0x00,0x0C,0x1C,0x3C,0x6C,0xCC,0xFF,0xFF,0x0C,0x0C,0x0C,0x00,0x00,0x00,
		0x00,0x00,0x00,0x60,0x60,0x60,0x60,0x60,0x7F,0x7F,0x60,0x60,0x60,0x00,0x00,0x00
	},

	// Digit 5
	{
		0xFC,0xFC,0x60,0x60,0x60,0x60,0x7C,0xFC,0x0C,0x0C,0x0C,0x0C,0xFC,0xF8,0x00,0x00,
		0x7F,0x7F,0x60,0x60,0x60,0x60,0x3F,0x1F,0x00,0x00,0x00,0x00,0x7F,0x7F,0x00,0x00,
		0xFC,0xFC,0x60,0x60,0x60,0x7C,0xFC,0x0C,0x0C,0x0C,0x0C,0xFC,0xF8,0x00,0x00,0x00,
		0x7F,0x7F,0x60,0x60,0x60,0x3F,0x1F,0x00,0x00,0x00,0x00,0x7F,0x7F,0x00,0x00,0x00
	},

	// Digit 6
	{
		0xF8,0xFC,0x0E,0x06,0x06,0x06,0x0E,0xFC,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x60,0x60,0x70,0x3F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0xF8,0xFC,0x0E,0x06,0x06,0x06,0x0E,0xFC,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x60,0x60,0x70,0x3F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00
	},

	// Digit 7
	{
		0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0xFC,0xFC,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x60,0x60,0x60,0x60,0x60,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,
		0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0xFC,0xFC,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x60,0x60,0x60,0x60,0x60,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00
	},

	// Digit 8
	{
		0xF8,0xFC,0x0E,0x06,0x06,0x0E,0xFC,0xF8,0xF8,0xFC,0x0E,0x06,0x06,0x0E,0xFC,0xF8,
		0x1F,0x3F,0x70,0x60,0x70,0x3F,0x1F,0x1F,0x3F,0x70,0x60,0x70,0x3F,0x1F,0x00,0x00,
		0xF8,0xFC,0x0E,0x06,0x06,0x0E,0xFC,0xF8,0xF8,0xFC,0x0E,0x06,0x06,0x0E,0xFC,0xF8,
		0x1F,0x3F,0x70,0x60,0x70,0x3F,0x1F,0x1F,0x3F,0x70,0x60,0x70,0x3F,0x1F,0x00,0x00
	},

	// Digit 9
	{
		0xF8,0xFC,0x0E,0x06,0x06,0x0E,0xFC,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x70,0x3F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0xF8,0xFC,0x0E,0x06,0x06,0x0E,0xFC,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x1F,0x3F,0x70,0x60,0x70,0x3F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
	}
};


// Clear the area for big number
void OLED_ClearNumberArea(uint8_t page, uint8_t col, uint8_t num_digits)
{
	for(uint8_t p=0; p<4; p++)
	{
		for(uint8_t d=0; d<num_digits; d++)
		{
			OLED_SetCursor(page + p, col + d*18);
			for(uint8_t i=0; i<16; i++)
			OLED_Data(0x00);
		}
	}
}

// Draw a single big digit
void OLED_PrintBigDigit(uint8_t page, uint8_t col, uint8_t digit)
{
	if(digit>9) return;
	for(uint8_t p=0; p<4; p++)
	{
		OLED_SetCursor(page + p, col);
		for(uint8_t i=0; i<16; i++)
		OLED_Data(Font16x32[digit][p*16 + i]);
	}
}

// Draw a number (single or multi-digit)
void OLED_PrintBigNumber(uint8_t page, uint8_t col, uint16_t number)
{
	uint8_t digits[7], count=0;

	if(number==0) { digits[count++] = 0; }
	else
	{
		while(number>0)
		{
			digits[count++] = number % 10;
			number /= 10;
		}
	}

	OLED_ClearNumberArea(page, col, count);

	for(int8_t i=count-1; i>=0; i--)
	{
		OLED_PrintBigDigit(page, col, digits[i]);
		col += 18;
	}
}

void OLED_PrintChar(char c)
{
	uint8_t i;
	uint8_t index;

	if (c >= '0' && c <= '9')
	{
		index = c - '0';
	}
	else if (c == ':')
	{
		index = 10;
	}
	else if (c == '-')
	{
		index = 11;
	}
	else
	{
		return; // unsupported character
	}

	for (i = 0; i < 8; i++)
	{
		OLED_Data(Font8x8[index][i]);
	}
}



void OLED_Print2Digit(uint8_t num)
{
	OLED_PrintChar((num / 10) + '0');
	OLED_PrintChar((num % 10) + '0');
}

void OLED_PrintTime(uint8_t hh, uint8_t mm, uint8_t ss)
{
	OLED_Print2Digit(hh);
	OLED_PrintChar(':');
	OLED_Print2Digit(mm);
	OLED_PrintChar(':');
	OLED_Print2Digit(ss);
}

void OLED_PrintDate(uint8_t dd, uint8_t mm, uint8_t yy)
{
	OLED_Print2Digit(dd);
	OLED_PrintChar('-');
	OLED_Print2Digit(mm);
	OLED_PrintChar('-');
	OLED_Print2Digit(yy);
}



void OLED_PrintCharLarge(char c)
{



	// Get current cursor position
	x = oled_x;
	page = oled_page;

	// Map char to font index
	if (c >= '0' && c <= '9')
	index = c - '0';
	else if (c == ':')
	index = 10;
	else if (c == '-')
	index = 11;
	else
	return;

	// -------- UPPER HALF (page P) --------
	OLED_SetCursor(x, page);

	for (i = 0; i < 8; i++)
	{
		col = Font8x8[index][i] & 0x0F; // lower 4 bits

		up_scaled = 0;
		for (bit = 0; bit < 4; bit++)
		if (col & (1 << bit))
		up_scaled |= (3 << (bit * 2));

		OLED_Data(up_scaled);
		OLED_Data(up_scaled);
	}

	// -------- LOWER HALF (page P+1) --------
	OLED_SetCursor(x, page + 1);

	for (i = 0; i < 8; i++)
	{
		col = (Font8x8[index][i] >> 4) & 0x0F;

		low_scaled = 0;
		for (bit = 0; bit < 4; bit++)
		if (col & (1 << bit))
		low_scaled |= (3 << (bit * 2));

		OLED_Data(low_scaled);
		OLED_Data(low_scaled);
	}

	// Move cursor to next character position
	oled_x += 16;
}


void OLED_Print2DigitLarge(uint8_t value)
{
	OLED_PrintCharLarge((value / 10) + '0');
	OLED_PrintCharLarge((value % 10) + '0');
}


void OLED_PrintTimeLarge(uint8_t hh, uint8_t mm, uint8_t ss)
{
	OLED_Print2DigitLarge(hh);
	OLED_PrintCharLarge(':');
	OLED_Print2DigitLarge(mm);
	OLED_PrintCharLarge(':');
	OLED_Print2DigitLarge(ss);
}


void OLED_PrintChar2x_Safe(char c)
{
	uint8_t x = oled_x;
	uint8_t p = oled_page;

	/* upper row */
	OLED_SetCursor(x, p);
	OLED_PrintChar(c);
	OLED_PrintChar(c);

	/* lower row */
	OLED_SetCursor(x, p + 1);
	OLED_PrintChar(c);
	OLED_PrintChar(c);

	oled_x += 16;   // advance by 2 chars width
}

void OLED_Print2Digit2x(uint8_t val)
{
	OLED_PrintChar2x_Safe((val / 10) + '0');
	OLED_PrintChar2x_Safe((val % 10) + '0');
}

void OLED_PrintTime2x(uint8_t hh, uint8_t mm)
{
	OLED_Print2Digit2x(hh);
	OLED_PrintChar2x_Safe(':');
	OLED_Print2Digit2x(mm);
}
